import{_ as u}from"./Modal.01712055.js";import{v}from"./vue3-qr-reader.common.84d2c55e.js";import{_ as h,u as f,a as k,r as b,o as y,c as g,b as s,d,w as a,t as w,e as l,p as T,f as M}from"./index.e70b3d69.js";import{_ as V}from"./alert.e79a58db.js";const x={setup(){return f({title:"\u6524\u4F4D\u6383\u63CF\u5668"}),{toast:k()}},components:{QrStream:v.exports.QrStream},data(){return{nonTokenModal:!1,tokenInvalidModal:!1,displayName:""}},created(){this.checkToken();let o=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${o}px`),document.querySelector('meta[name="theme-color"]').setAttribute("content","#82d357")},methods:{async checkToken(){let o=this.$route.query.token;if(!o){this.nonTokenModal=!0;return}let e=await fetch(`https://sitcon.opass.app/event/puzzle/deliverer?token=${o}`);e.ok?(e=await e.json(),e.slug&&(this.displayName=e.slug)):this.tokenInvalidModal=!0},async onDecode(o){if(o){this.$refs.beep.play(),navigator.vibrate&&navigator.vibrate(10),console.log(o);let e=this.$route.query.token,r=new FormData;r.append("receiver",o);let t=await fetch(`https://sitcon.opass.app/event/puzzle/deliver?token=${e}`,{method:"POST",body:r});if(t.ok){t=await t.json();let{user_id:n}=t;this.toast.success(`\u5DF2\u6210\u529F\u767C\u9001\u7D66\u300C${n}\u300D`)}else t=await t.json(),t.message=="Already take from this deliverer"?this.toast.info("\u8A72\u6703\u773E\u5DF2\u53D6\u5F97\u788E\u7247\uFF01"):t.message=="invalid receiver token"?this.toast.error("\u7121\u6548\u7684 QR code\uFF01"):this.toast.error(t.message)}}}},c=o=>(T("data-v-b1bb4332"),o=o(),M(),o),I={class:"mobile-view-container"},S={class:"mobile-view"},D={class:"header"},q={class:"title"},N=c(()=>s("div",{class:"subtitle"},"\u6524\u4F4D\u6383\u63CF\u5668",-1)),$=c(()=>s("div",{class:"frame"},null,-1)),z=l(" \u672A\u5075\u6E2C\u5230 Token "),C=l(" \u8ACB\u6AA2\u67E5\u9023\u7D50\u662F\u5426\u6709\u7F3A\u6F0F\uFF0C\u82E5\u6301\u7E8C\u767C\u751F\u6B64\u554F\u984C\uFF0C\u8ACB\u806F\u7D61\u5DE5\u4F5C\u4EBA\u54E1\u3002 "),Q=l(" Token \u7121\u6548 "),j=l(" \u8ACB\u6AA2\u67E5\u9023\u7D50\u662F\u5426\u6709\u7F3A\u6F0F\uFF0C\u82E5\u6301\u7E8C\u767C\u751F\u6B64\u554F\u984C\uFF0C\u8ACB\u806F\u7D61\u5DE5\u4F5C\u4EBA\u54E1\u3002 "),B={id:"beep",ref:"beep",style:{display:"none"}},A=c(()=>s("source",{src:V,type:"audio/ogg"},null,-1)),E=[A];function H(o,e,r,t,n,p){const m=b("qr-stream"),_=u;return y(),g("div",I,[s("div",S,[d(m,{onDecode:p.onDecode,class:"qrstream"},{default:a(()=>[s("div",null,[s("div",D,[s("div",q,w(n.displayName),1),N]),$])]),_:1},8,["onDecode"]),d(_,{modelValue:n.nonTokenModal,"onUpdate:modelValue":e[1]||(e[1]=i=>n.nonTokenModal=i)},{title:a(()=>[z]),content:a(()=>[C]),actions:a(()=>[s("a",{class:"modal-action",onClick:e[0]||(e[0]=i=>n.nonTokenModal=!1)},"\u95DC\u9589")]),_:1},8,["modelValue"]),d(_,{modelValue:n.tokenInvalidModal,"onUpdate:modelValue":e[3]||(e[3]=i=>n.tokenInvalidModal=i)},{title:a(()=>[Q]),content:a(()=>[j]),actions:a(()=>[s("a",{class:"modal-action",onClick:e[2]||(e[2]=i=>n.nonTokenModal=!1)},"\u95DC\u9589")]),_:1},8,["modelValue"]),s("audio",B,E,512)])])}const O=h(x,[["render",H],["__scopeId","data-v-b1bb4332"]]);export{O as default};
