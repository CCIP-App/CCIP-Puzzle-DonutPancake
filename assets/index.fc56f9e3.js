import{_ as M}from"./Modal.01712055.js";import{_ as x,ap as w,r as Q,o as l,c as i,b as t,d as p,w as a,b7 as C,bp as T,e as _,p as V,f as S,ac as I,a as R,u as D,i as m,Z as g,aL as P,t as k}from"./index.e70b3d69.js";import{v as N}from"./vue3-qr-reader.common.84d2c55e.js";import{_ as U}from"./loader.81f62f7b.js";import{p as j}from"./puzzles.fc2b5e47.js";import{_ as q}from"./meow-puzzle.d6420114.js";const L={setup(){return{cryoptojs:w("cryptojs")}},components:{QrStream:N.exports.QrStream},data(){return{manualInputModal:!1,scanQRCodeModal:!1,token:""}},methods:{goToken(){let n=this.cryoptojs.SHA1(this.token).toString();location.href=`/?token=${n}`},onDecode(n){this.token=n,this.scanQRCodeModal=!1,this.goToken()}}},z=n=>(V("data-v-05b4cf53"),n=n(),S(),n),O=z(()=>t("p",{style:{"margin-top":"0"}}," \u8ACB\u6AA2\u67E5 OPass \u662F\u5426\u5DF2\u6210\u529F\u5831\u5230\uFF0C\u6216\u900F\u904E\u4E0B\u5217\u65B9\u5F0F\u9032\u5165\u904A\u6232\u3002 ",-1)),B={class:"select-items"},A=I('<div class="icon" data-v-05b4cf53><i class="bx bxs-keyboard" data-v-05b4cf53></i></div><div class="content" data-v-05b4cf53><div class="title" data-v-05b4cf53>\u624B\u52D5\u8F38\u5165\u7968\u5238\u4EE3\u78BC</div><div class="description" data-v-05b4cf53></div></div>',2),H=[A],J=I('<div class="icon" data-v-05b4cf53><i class="bx bx-qr-scan" data-v-05b4cf53></i></div><div class="content" data-v-05b4cf53><div class="title" data-v-05b4cf53>\u6383\u63CF\u7968\u5238 QR Code</div><div class="description" data-v-05b4cf53></div></div>',2),Z=[J],E=_(" \u624B\u52D5\u8F38\u5165\u7968\u5238\u4EE3\u78BC "),F=z(()=>t("p",{style:{"margin-top":"0"}},"\u8ACB\u8F38\u5165 OPass \u7968\u5238\u4EE3\u78BC",-1)),W=_(" \u6383\u63CF\u7968\u5238 QR Code "),X=z(()=>t("p",{style:{"margin-top":"0"}},"\u8ACB\u958B\u555F OPass \u4E2D\u7684\u6211\u7684\u7968\u5238\uFF0C\u4E26\u6383\u63CF\u5176\u4E2D\u7684 QR Code",-1)),G=z(()=>t("div",{class:"frame"},null,-1));function K(n,e,r,v,s,u){const h=M,y=Q("qr-stream");return l(),i("div",null,[O,t("div",B,[t("div",{class:"select-item",onClick:e[0]||(e[0]=d=>s.manualInputModal=!0)},H),t("div",{class:"select-item",onClick:e[1]||(e[1]=d=>s.scanQRCodeModal=!0)},Z)]),p(h,{modelValue:s.manualInputModal,"onUpdate:modelValue":e[5]||(e[5]=d=>s.manualInputModal=d)},{title:a(()=>[E]),content:a(()=>[F,C(t("input",{class:"input","onUpdate:modelValue":e[2]||(e[2]=d=>s.token=d),placeholder:"\u8ACB\u8F38\u5165\u7968\u5238\u4EE3\u78BC"},null,512),[[T,s.token]])]),actions:a(()=>[t("a",{class:"modal-action",onClick:e[3]||(e[3]=d=>s.manualInputModal=!1)},"\u53D6\u6D88"),t("a",{class:"modal-action primary",onClick:e[4]||(e[4]=(...d)=>u.goToken&&u.goToken(...d))},"\u5B8C\u6210")]),_:1},8,["modelValue"]),p(h,{modelValue:s.scanQRCodeModal,"onUpdate:modelValue":e[7]||(e[7]=d=>s.scanQRCodeModal=d)},{title:a(()=>[W]),content:a(()=>[X,p(y,{onDecode:u.onDecode,class:"qrstream"},{default:a(()=>[G]),_:1},8,["onDecode"])]),actions:a(()=>[t("a",{class:"modal-action",onClick:e[6]||(e[6]=d=>s.scanQRCodeModal=!1)},"\u53D6\u6D88")]),_:1},8,["modelValue"])])}const Y=x(L,[["render",K],["__scopeId","data-v-05b4cf53"]]);const $={setup(){const n=R();return D({title:"\u788E\u7247"}),{toast:n}},data(){return{puzzleList:j,doneModal:!1,nonTokenModal:!1,historyModal:!1,addPartnerModal:!1,copyModal:!1,partnerToken:"",hasPartner:!1,puzzles:null,partnerPuzzles:null,deliverers:null}},async created(){this.getData()},methods:{async getData(){let n=this.$route.query.token||localStorage.getItem("token"),e=localStorage.getItem("partnerToken");if(n){localStorage.setItem("token",n);let r=await this.getPuzzles(n);r?(this.puzzles=r.puzzles,this.deliverers=r.deliverers):(this.nonTokenModal=!0,this.puzzles=[],this.deliverers=[])}else this.nonTokenModal=!0,this.puzzles=[],this.deliverers=[];if(e){this.hasPartner=!0;let r=await this.getPuzzles(e);r?this.partnerPuzzles=r.puzzles:(this.hasPartner=!1,localStorage.removeItem("partnerToken"),this.toast.error("\u7121\u6CD5\u53D6\u5F97\u5925\u4F34\u7684\u788E\u7247\uFF0C\u8ACB\u91CD\u65B0\u52A0\u5165\u5925\u4F34\u3002"),this.partnerPuzzles=[])}},async getPuzzles(n){let e=await fetch(`https://sitcon.opass.app/event/puzzle?token=${n}`);return e.ok?(e=await e.json(),e.deliverers=e.deliverers.sort((r,v)=>v.timestamp-r.timestamp),e.valid&&(this.doneModal=!0),e):null},async copy(n){try{await navigator.clipboard.writeText(n),this.toast.success("\u8907\u88FD\u6210\u529F\uFF01")}catch{window.prompt("\u8ACB\u8907\u88FD\u4EE5\u4E0B\u5167\u5BB9",n)}},async copyToken(n="token"){let e=localStorage.getItem("token");this.copy(n=="token"?e:`https://puzzle.sitcon.party/?token=${e}`)},async addPartner(){let n=this.partnerToken,e=this.$route.query.token||localStorage.getItem("token");if(n!=e){let r=await this.getPuzzles(n);r?(localStorage.setItem("partnerToken",n),this.hasPartner=!0,this.addPartnerModal=!1,this.partnerPuzzles=r.puzzles,this.toast.success("\u6210\u529F\u52A0\u5165\u5925\u4F34\uFF01"),this.updatePuzzleProgress()):this.toast.error("\u7CDF\u7CD5\uFF0C\u4F60\u8F38\u5165\u7684\u4F3C\u4E4E\u4E0D\u662F\u6B63\u78BA\u7684\u9023\u7D50\uFF01")}else this.toast.error("\u597D\u50CF\u6C92\u8FA6\u6CD5\u5C07\u81EA\u5DF1\u52A0\u5165\u70BA\u5925\u4F34\u3002 (\uFF1B\u2032\u2312`)")},removePartner(){localStorage.removeItem("partnerToken"),this.hasPartner=!1,this.partnerPuzzles=[],this.addPartnerModal=!1,this.toast.info("\u5925\u4F34\u5DF2\u79FB\u9664\u3002"),this.updatePuzzleProgress()},updatePuzzleProgress(){let n=[...this.puzzles,...this.partnerPuzzles];for(let e=1;e<=5;e++){let r=localStorage.getItem(`problem-${e}`);r&&(r=JSON.parse(r),r=r.filter(v=>n.includes(v)),localStorage.setItem(`problem-${e}`,JSON.stringify(r)))}}}},c=n=>(V("data-v-d0c1257c"),n=n(),S(),n),ee={class:"title-bar"},te=c(()=>t("h1",null,"\u788E\u7247",-1)),se={class:"actions"},oe=c(()=>t("i",{class:"bx bx-copy"},null,-1)),ne=[oe],le=c(()=>t("i",{class:"bx bx-history"},null,-1)),ie=[le],ae={key:0},re={key:1,class:"card"},de={key:2,class:"card puzzle-cards"},ce={key:3},pe={key:4,class:"card"},ue={key:5,class:"card puzzle-cards"},_e={key:0},me=c(()=>t("i",{class:"bx bx-refresh"},null,-1)),ve=c(()=>t("span",null,"\u66F4\u63DB / \u79FB\u9664\u5925\u4F34",-1)),he=[me,ve],ke={key:1},ze=c(()=>t("i",{class:"bx bx-plus"},null,-1)),ye=c(()=>t("span",null,"\u52A0\u5165\u5925\u4F34",-1)),fe=[ze,ye],ge=c(()=>t("img",{src:q,class:"cat-bg"},null,-1)),Pe=_(" \u5C1A\u672A\u767B\u5165\u6216\u672A\u5B8C\u6210\u5831\u5230 "),be=_(" \u606D\u559C\uFF01 "),Me=_(" \u4F60\u5DF2\u5B8C\u6210\u6D3B\u52D5\u4E26\u6210\u529F\u514C\u63DB\u9650\u91CF\u734E\u54C1\u53CA\u62BD\u734E\u5238\uFF0C\u611F\u8B1D\u4F60\u53C3\u52A0 SITCON X \u7A0B\u5F0F\u78BC\u62FC\u5716\u6D3B\u52D5\uFF01 "),xe={key:0},Ce={key:1},Te=c(()=>t("div",{class:"add-partner-steps"},[t("div",{class:"add-partner-step"},[t("div",{class:"step-icon"},[t("i",{class:"bx bx-copy"})]),t("div",{class:"step-title"},"1. \u8907\u88FD\u5925\u4F34\u4EE3\u78BC"),t("div",{class:"step-description"},"\u958B\u555F\u5925\u4F34\u7684\u788E\u7247\u9801\u9762\uFF0C\u8F15\u89F8\u53F3\u4E0A\u89D2\u7684\u8907\u88FD\u6309\u9215\uFF0C\u9078\u64C7\u300C\u8907\u88FD\u5925\u4F34\u4EE3\u78BC\u300D\u3002")]),t("div",{class:"add-partner-step"},[t("div",{class:"step-icon"},[t("i",{class:"bx bx-paste"})]),t("div",{class:"step-title"},"2. \u8CBC\u4E0A\u5925\u4F34\u4EE3\u78BC"),t("div",{class:"step-description"},"\u900F\u904E\u901A\u8A0A\u8EDF\u9AD4\u7B49\u65B9\u5F0F\uFF0C\u53D6\u5F97\u5C0D\u65B9\u7684\u5925\u4F34\u4EE3\u78BC\u8CBC\u81F3\u4E0B\u65B9\u6B04\u4F4D\uFF0C\u4E26\u6309\u4E0B\u78BA\u5B9A\u3002")])],-1)),Ve={class:"input-description"},Se={key:0},Ie={key:1},we=c(()=>t("div",{style:{flex:"1"}},null,-1)),Qe=_(" \u788E\u7247\u53D6\u5F97\u7D00\u9304 "),Re={class:"history-cards"},De={class:"history-card-name"},Ne={class:"history-card-time"},Ue={key:0},je=_(" \u8907\u88FD "),qe=c(()=>t("p",{style:{"margin-top":"0"}},"\u4F60\u53EF\u4EE5\u5B89\u5FC3\u5730\u516C\u958B\u4EE3\u78BC\u8B93\u5C0D\u65B9\u6E2C\u8A66\u80FD\u5426\u5B8C\u6210\u984C\u76EE\uFF0C\u5B8C\u6210\u5927\u5730\u904A\u6232\u9700\u8981\u5169\u4EBA\u4E00\u540C\u5728\u5927\u6703\u670D\u52D9\u53F0\u51FA\u793A\u7968\u5238 QR Code\u3002",-1)),Le={class:"select-items"},Oe=c(()=>t("div",{class:"icon"},[t("i",{class:"bx bx-share-alt"})],-1)),Be=c(()=>t("div",{class:"content"},[t("div",{class:"title"},"\u8907\u88FD\u5925\u4F34\u4EE3\u78BC"),t("div",{class:"description"},"\u63D0\u4F9B\u4EE3\u78BC\u7D66\u670B\u53CB\u52A0\u5165\u70BA\u89E3\u984C\u5925\u4F34\u3002")],-1)),Ae=[Oe,Be],He=c(()=>t("div",{class:"icon"},[t("i",{class:"bx bx-user"})],-1)),Je=c(()=>t("div",{class:"content"},[t("div",{class:"title"},"\u8907\u88FD\u5C08\u5C6C\u7DB2\u5740"),t("div",{class:"description"},"\u8B93\u4F60\u80FD\u5920\u5728\u5176\u4ED6\u88DD\u7F6E\u6216\u700F\u89BD\u5668\u4E2D\u9032\u884C\u5927\u5730\u904A\u6232\uFF0C\u4E0D\u904E\u89E3\u984C\u9032\u5EA6\u7121\u6CD5\u88AB\u540C\u6B65\u3002")],-1)),Ze=[He,Je];function Ee(n,e,r,v,s,u){var b;const h=U,y=Y,d=M;return l(),i("div",null,[t("div",ee,[te,t("div",se,[t("div",{class:"icon-btn",onClick:e[0]||(e[0]=o=>s.copyModal=!0)},ne),t("div",{class:"icon-btn",onClick:e[1]||(e[1]=o=>s.historyModal=!0)},ie)])]),s.hasPartner?(l(),i("h2",ae,"\u4F60\u7684\u788E\u7247")):m("",!0),s.puzzles?s.puzzles.length?(l(),i("div",de,[(l(!0),i(g,null,P(s.puzzles,o=>(l(),i("div",{class:"puzzle-card",key:o},k(s.puzzleList[o]),1))),128))])):m("",!0):(l(),i("div",re,[p(h)])),s.hasPartner?(l(),i("h2",ce,"\u5925\u4F34\u7684\u788E\u7247")):m("",!0),s.hasPartner&&!s.partnerPuzzles?(l(),i("div",pe,[p(h)])):s.hasPartner&&((b=s.partnerPuzzles)==null?void 0:b.length)?(l(),i("div",ue,[(l(!0),i(g,null,P(s.partnerPuzzles,o=>(l(),i("div",{class:"puzzle-card",key:o},k(s.puzzleList[o]),1))),128))])):m("",!0),t("div",{class:"btn",onClick:e[2]||(e[2]=o=>s.addPartnerModal=!0)},[s.hasPartner?(l(),i("span",_e,he)):(l(),i("span",ke,fe))]),ge,p(d,{modelValue:s.nonTokenModal,"onUpdate:modelValue":e[4]||(e[4]=o=>s.nonTokenModal=o)},{title:a(()=>[Pe]),content:a(()=>[p(y)]),actions:a(()=>[t("a",{class:"modal-action danger",onClick:e[3]||(e[3]=o=>s.nonTokenModal=!1)},"\u53D6\u6D88")]),_:1},8,["modelValue"]),p(d,{modelValue:s.doneModal,"onUpdate:modelValue":e[6]||(e[6]=o=>s.doneModal=o)},{title:a(()=>[be]),content:a(()=>[Me]),actions:a(()=>[t("a",{class:"modal-action",onClick:e[5]||(e[5]=o=>s.doneModal=!1)},"\u95DC\u9589")]),_:1},8,["modelValue"]),p(d,{modelValue:s.addPartnerModal,"onUpdate:modelValue":e[11]||(e[11]=o=>s.addPartnerModal=o)},{title:a(()=>[s.hasPartner?(l(),i("span",xe," \u66F4\u63DB / \u79FB\u9664\u5925\u4F34 ")):(l(),i("span",Ce," \u52A0\u5165\u5925\u4F34 "))]),content:a(()=>[Te,C(t("input",{class:"input","onUpdate:modelValue":e[7]||(e[7]=o=>s.partnerToken=o),placeholder:"\u8ACB\u8F38\u5165\u5925\u4F34\u4EE3\u78BC"},null,512),[[T,s.partnerToken]]),t("div",Ve,[s.hasPartner?(l(),i("span",Se," \u4F60\u5148\u524D\u5DF2\u65B0\u589E\u5176\u4ED6\u5925\u4F34\uFF0C\u8207\u65B0\u7684\u5925\u4F34\u8E0F\u4E0A\u65C5\u7A0B\u7684\u8A71\uFF0C\u5148\u524D\u7684\u5925\u4F34\u5C07\u6703\u88AB\u53D6\u4EE3\u3002 ")):(l(),i("span",Ie," \u8207\u5925\u4F34\u8E0F\u4E0A\u65C5\u7A0B\u7684\u8A71\uFF0C\u53EF\u4EE5\u4F7F\u7528\u5C0D\u65B9\u7684\u788E\u7247\u9032\u884C\u89E3\u984C\u3002 "))])]),actions:a(()=>[s.hasPartner?(l(),i("a",{key:0,class:"modal-action danger",onClick:e[8]||(e[8]=(...o)=>u.removePartner&&u.removePartner(...o))},"\u79FB\u9664\u5925\u4F34")):m("",!0),we,t("a",{class:"modal-action",onClick:e[9]||(e[9]=o=>s.addPartnerModal=!1)},"\u53D6\u6D88"),t("a",{class:"modal-action primary",onClick:e[10]||(e[10]=(...o)=>u.addPartner&&u.addPartner(...o))},"\u78BA\u5B9A")]),_:1},8,["modelValue"]),p(d,{modelValue:s.historyModal,"onUpdate:modelValue":e[13]||(e[13]=o=>s.historyModal=o)},{title:a(()=>[Qe]),content:a(()=>{var o;return[t("div",Re,[(l(!0),i(g,null,P(s.deliverers,f=>(l(),i("div",{class:"history-card",key:f.timestamp},[t("div",De,k(f.deliverer),1),t("div",Ne,k(new Date(f.timestamp*1e3).toLocaleString("zh-TW",{timeZone:"Asia/Taipei",hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})),1)]))),128))]),(o=s.deliverers)!=null&&o.length?m("",!0):(l(),i("div",Ue," \u66AB\u7121\u7D00\u9304 "))]}),actions:a(()=>[t("a",{class:"modal-action",onClick:e[12]||(e[12]=o=>s.historyModal=!1)},"\u95DC\u9589")]),_:1},8,["modelValue"]),p(d,{modelValue:s.copyModal,"onUpdate:modelValue":e[17]||(e[17]=o=>s.copyModal=o)},{title:a(()=>[je]),content:a(()=>[qe,t("div",Le,[t("div",{class:"select-item",onClick:e[14]||(e[14]=o=>u.copyToken("token"))},Ae),t("div",{class:"select-item",onClick:e[15]||(e[15]=o=>u.copyToken("url"))},Ze)])]),actions:a(()=>[t("a",{class:"modal-action",onClick:e[16]||(e[16]=o=>s.copyModal=!1)},"\u95DC\u9589")]),_:1},8,["modelValue"])])}const $e=x($,[["render",Ee],["__scopeId","data-v-d0c1257c"]]);export{$e as default};
